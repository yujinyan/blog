---
title: TypeScript ç±»å‹ç¼–ç¨‹æŒ‡å—
date: "2022-09-25T11:07:17.284Z"
---

import PullQuote from "@/components/PullQuote"
import DiscloseAnswer from "@/components/DiscloseAnswer"

ä¸¤ä¸ªè§†è§’ï¼š

- ç±»å‹ç³»ç»Ÿæ˜¯é›†åˆ
- ç±»å‹ç³»ç»Ÿæ˜¯ç¼–ç¨‹è¯­è¨€


## ç±»å‹æ˜¯é›†åˆ

### å…ƒç´ äº¤é›†ä¸å¹¶é›†

```tsx
type S1 = 1 | 2 | 3
type S2 = 3 | 4 | 5
type S3 = 6 | 7 | 8
type S4 = 1 | 2

type R1 = S1 | S2 // 1 | 2 | 3 | 4 | 5
type R2 = S1 & S2 // 3
type R4 = Exclude<S1, S2> // 1 | 2
type R5 = S4 extends S1 ? "Yes" : "No"
type R6 = S3 extends S1 ? "Yes" : "No"
```


### å…¨é›†ä¸ç©ºé›†

ç©ºé›†ï¼š`never`

```tsx
(1 | 2 | 3) & (4 | 5 | 6) // never
keyof {}                  // never
```

å…¨é›†ï¼š`unknown`

```tsx
// In an intersection everything absorbs unknown
type T00 = unknown & null;              // null
type T01 = unknown & undefined;         // undefined
type T02 = unknown & null & undefined;  // null & undefined (which becomes never in union)
type T03 = unknown & string;            // string
type T04 = unknown & string[];          // string[]
type T05 = unknown & unknown;           // unknown
type T06 = unknown & any;               // any

// In a union an unknown absorbs everything
type T10 = unknown | null;              // unknown
type T11 = unknown | undefined;         // unknown
type T12 = unknown | null | undefined;  // unknown
type T13 = unknown | string;            // unknown
type T14 = unknown | string[];          // unknown
type T15 = unknown | unknown;           // unknown
type T16 = unknown | any;               // any
```

### `unknown` ä¸ `any` çš„åŒºåˆ«

`any` ç›¸å½“äºå…³é—­äº†ç±»å‹æ£€æŸ¥ï¼Œå¯ä»¥å¯¹ `any` åšä»»ä½•ä»»ä½•æ“ä½œï¼Œæ”¹æˆ `unknown` åéƒ½æ˜¯ç¼–è¯‘é”™è¯¯ï¼š

```tsx
function f1(a: any) {
  a.foo
  a["foo"]
  a()
}

function f2(a: unknown) {
  a.foo    // error
  a["foo"] // error
  a()      // error
}
```

å¿…é¡»å¯¹ `unknown` çš„å€¼åšå‡ºç›¸åº”çš„ç±»å‹æ£€æŸ¥ï¼š

```tsx
function f2(a: unknown) {
  if (typeof a == 'function') {
    a()
  }

  if (typeof a == 'object' && a != null && "foo" in a) {
    a["foo"]
  }
}
```

[https://github.com/microsoft/TypeScript/pull/24439](https://github.com/microsoft/TypeScript/pull/24439)

## ç±»å‹æ˜¯ç¼–ç¨‹è¯­è¨€

TypeScript = JavaScript + ç±»å‹è¯­è¨€ï¼š

|     | JavaScript | ç±»å‹è¯­è¨€ |
|-----|------------|------|
| ä½œç”¨äº | å€¼          | é›†åˆ   |
| å­˜åœ¨äº | è¿è¡Œæ—¶        | ç¼–è¯‘æ—¶  |

JavaScript å’Œç±»å‹è¯­è¨€ä¹‹é—´çš„äº¤äº’ï¼š

- JavaScript â†’ ç±»å‹è¯­è¨€ï¼š`foo: Foo`
- ç±»å‹è¯­è¨€ â†’ JavaScriptï¼š`typeOf foo`

### ç»‘å®šå£°æ˜

```tsx
const obj = {name: 'foo'}
type Obj = {name: string}
```

### æ¡ä»¶åˆ¤æ–­

[https://www.typescriptlang.org/docs/handbook/2/conditional-types.html](https://www.typescriptlang.org/docs/handbook/2/conditional-types.html)

```tsx
SomeType extends OtherType ? TrueType : FalseType;
```

[https://github.com/microsoft/TypeScript/pull/21316](https://github.com/microsoft/TypeScript/pull/21316)

### éå†

```tsx
type User = {
  name: string
  gender: "M" | "F"
}

type User1 = {
  [F in keyof User as Capitalize<F>]: User[F] // highlight-line
}
```

- å°† `User` ç±»å‹ä¸­æ¯ä¸€ä¸ªé”® `F` å˜æ¢æˆ `Capitalize<F>`
- è¿™ä¸ªé”®å¯¹åº”çš„å€¼ç±»å‹æ˜¯ `User[F]`ï¼Œå³ä¿æŒä¸å˜

### å‡½æ•°

å¯ä»¥å°†èŒƒå‹ç±»æ¯”å‡½æ•°ï¼š

```tsx
function union(x, y) {
  return [...new Set([...x, ...y])]
}
```

```tsx
type Union<X, Y> = X | Y
```

- `Union`: å‡½æ•°å
- `<X, Y>`: å£°æ˜å‡½æ•°å…¥å‚
- ç­‰å·å³ä¾§ `X | Y`: å‡½æ•°è¿”å›å€¼


<PullQuote emoji="ğŸ–‹">

  [Type Challenge](https://github.com/type-challenges/type-challenges/blob/main/questions/00003-medium-omit/README.md)ï¼š
  å°è¯•è‡ªå·±å®ç° ts å†…ç½®çš„è¾…åŠ©ç±»ï¼š`Omit<T, K>`ï¼Œå…¶ä½œç”¨æ˜¯ä» `T` ä¸­ç§»é™¤æ‰€æœ‰ `K` é‡Œåˆ—å‡ºæ¥çš„å±æ€§ï¼Œä¾‹å¦‚ï¼š

```typescript
interface Todo {
  title: string
  description: string
  completed: boolean
}

type TodoPreview = MyOmit<Todo, 'description' | 'title'>

const todo: TodoPreview = {
  completed: false
}
  ```

  <DiscloseAnswer>
    ```typescript
    type MyOmit<T, O> = {
      [P in keyof T as P extends O ? never : P]: T[P]
    }
    ```
  </DiscloseAnswer>
</PullQuote>


### é€’å½’

ç»ƒä¹ ï¼š

`DeepReadonly`

### æ¨¡æ¿å­—ç¬¦ä¸²

```tsx
type Events = 'Created' | 'Approved' | 'Terminated'
type EventHandler = `on${Events}`
```

[https://github.com/microsoft/TypeScript/pull/40336](https://github.com/microsoft/TypeScript/pull/40336)

### å±æ€§ã€å…ƒç´ è®¿é—®

è®¿é—®å¯¹è±¡å±æ€§ï¼š

```tsx
type Config = { key: string, value: string }
type Key = Config['key'] // string
```

è®¿é—®æ•°ç»„å†…å…ƒç´ ï¼š`ArrayType[number]`

```tsx
const MyArray = [
  { name: "Alice", age: 15 },
  { name: "Bob", age: 23 },
  { name: "Eve", age: 38 },
];

type Person = typeof MyArray[number];
```


<PullQuote emoji="ğŸ–‹">
  å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªè·¯ç”±é…ç½®å’Œè·³è½¬æ–¹æ³•ï¼š

  ```tsx
  const routes = {
    index: {
      path: "/index",
      payload: {} as { page: number }
    },
    search: {
      path: "/search",
      payload: {} as { query: string }
    }
  }

  declare function navigateTo(
    route: string,
    payload: Record<string, string>
  )
  navigateTo("index", { page: 1 })
  ```

  è¯·é‡æ„ `navigateTo` çš„ç±»å‹æ ‡æ³¨ï¼Œä½¿å¾—ä»¥ä¸‹è°ƒç”¨éƒ½ç¼–è¯‘é”™è¯¯ï¼š

  ```jsx
  navigateTo("blah", { page: 1 }) // ä¸å­˜åœ¨çš„è·¯ç”±
  navigateTo("search", { page: 1 }) // ä¸åŒ¹é…çš„è·¯ç”±å‚æ•°é…ç½®
  ```

  <DiscloseAnswer>
    ```typescript
    declare function myNavigateTo<T extends keyof typeof routes>(
      route: T,
      payload: (typeof routes)[T]['payload']
    ): void
    ```
  </DiscloseAnswer>
</PullQuote>

## å‚è€ƒèµ„æ–™

- [An introduction to type programming in TypeScript](https://www.zhenghao.io/posts/type-programming)
- [https://github.com/type-challenges/type-challenges](https://github.com/type-challenges/type-challenges)
